
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Examples &#8212; madupite</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=8a448e45"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'examples';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Madupite Options" href="options.html" />
    <link rel="prev" title="Tutorials" href="tutorial.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/madupite_logo.png" class="logo__image only-light" alt=""/>
    <script>document.write(`<img src="_static/madupite_logo.png" class="logo__image only-dark" alt=""/>`);</script>
  
  
    <p class="title logo__title">madupite</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="install.html">
    Installation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="tutorial.html">
    Tutorials
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="#">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="options.html">
    Options
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="apiref.html">
    API Reference
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="install.html">
    Installation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="tutorial.html">
    Tutorials
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="#">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="options.html">
    Options
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="apiref.html">
    API Reference
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">Examples</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="examples">
<h1>Examples<a class="headerlink" href="#examples" title="Link to this heading">#</a></h1>
<p>Here you can find some examples on how to use <code class="docutils literal notranslate"><span class="pre">madupite</span></code> to create and solve MDPs arising from different scenarios. But first, a small recap on MDPs.</p>
<p>MDPs are a very useful tool to describe stochastic dynamical systems. In mathematical terms, an MDP is a 5-elements tuple <span class="math notranslate nohighlight">\((\mathcal{S}, \mathcal{A}, P, g, \gamma)\)</span>, where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\mathcal{S} = \{0, 1, \dots, n-1\}\)</span> is the set of states,</p></li>
<li><p><span class="math notranslate nohighlight">\(\mathcal{A} = \{0, 1, \dots, m-1\}\)</span> is the set of actions,</p></li>
<li><p><span class="math notranslate nohighlight">\(P : \mathcal{S} \times \mathcal{A} \times \mathcal{S} \to [0, 1]\)</span> is the transition probability function, where <span class="math notranslate nohighlight">\(P(s, a, s') = \text{Pr}(s_{t+1} = s' | s_t = s, a_t = a)\)</span> and <span class="math notranslate nohighlight">\(\sum_{s' \in \mathcal{S}} P(s, a, s') = 1\)</span> for all <span class="math notranslate nohighlight">\(s \in \mathcal{S}\)</span> and <span class="math notranslate nohighlight">\(a \in \mathcal{A}\)</span>,</p></li>
<li><p><span class="math notranslate nohighlight">\(g : \mathcal{S} \times \mathcal{A} \to \mathbb{R}\)</span> is the stage cost function (or reward in an alternative but equivalent formulation),</p></li>
<li><p><span class="math notranslate nohighlight">\(\gamma \in (0, 1)\)</span> is the discount factor.</p></li>
</ul>
<p>Given an MDP, <code class="docutils literal notranslate"><span class="pre">madupite</span></code> will compute which actions should be played on the system such that the cumulative discounted cost (reward) over the infinite-horizon is minimized (maximized). You can find more details on the mathematical formulation of the problem setting in [Gargiani2024].</p>
<section id="toy-example">
<h2>Toy-Example<a class="headerlink" href="#toy-example" title="Link to this heading">#</a></h2>
<p>We start with a simple example.
Let’s consider an agent that lives on a periodic 1-dimensional line of length 50. At each time-step, the agent has to decide whether moving to the left, to the right or staying in its place. The goal is to reach state 42 with the minimal number of steps. This problem can be mathematically formulated as an MDP with <span class="math notranslate nohighlight">\(\mathcal{S} = \left\{0, \,1,\,\dots,\,49 \right\}\)</span> and <span class="math notranslate nohighlight">\(\mathcal{A} = \left\{0,\,1,\,2\right\}\)</span>, where 0 corresponds to the action <em>stay</em>, 1 to the action <em>move-left</em> and 2 to the action <em>move-right</em>. By moving to the right from state <span class="math notranslate nohighlight">\(s\)</span> the agent will lend to state <span class="math notranslate nohighlight">\((s+1) \,\text{mod}\, 50\)</span> and by moving to the left it will move to state <span class="math notranslate nohighlight">\((s-1) \,\text{mod}\, 50\)</span>. Transitions are deterministic in this case and a probability of 1 is associated to the triplet <span class="math notranslate nohighlight">\((s,a,s')\)</span> only when <span class="math notranslate nohighlight">\(s\)</span> is the transitioning state associated to the pair <span class="math notranslate nohighlight">\((s,a)\)</span>. Finally, the agent will get a reward of 1 if it reaches state 42, while a reward of 0 is associated to all other state-action pairs.
Imagine also the scenario where our agent is moving on ice. When it tries to move to the left (or right), there is a 10% chance that it falls and ends up staying in its place instead of moving in state <span class="math notranslate nohighlight">\((s-1)\,\text{mod}\,50\)</span> (or <span class="math notranslate nohighlight">\((s-1)\,\text{mod}\,50\)</span>). The slippery iced floor also introduces a 10% chance that when it plays action 0 it slips to the left or right state.
Now we turn this into code and use <code class="docutils literal notranslate"><span class="pre">madupite</span></code> to model and solve the MDP associated to the described system.</p>
<a class="reference internal image-reference" href="_images/tutorial_ex1.jpg"><img alt="_images/tutorial_ex1.jpg" class="align-center" src="_images/tutorial_ex1.jpg" style="width: 443.45px; height: 444.15px;" />
</a>
<p>We start by defining the transition probability function for both the deterministic and the stochastic scenario, and the reward function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">P_deterministic</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># stay</span>
        <span class="k">return</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">state</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># left</span>
        <span class="k">return</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[(</span><span class="n">state</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">50</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="c1"># right</span>
        <span class="k">return</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[(</span><span class="n">state</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">50</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">P_stochastic</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># stay</span>
        <span class="k">return</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> <span class="p">[(</span><span class="n">state</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">50</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="p">(</span><span class="n">state</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">50</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># left</span>
        <span class="k">return</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">],</span> <span class="p">[</span><span class="n">state</span><span class="p">,</span> <span class="p">(</span><span class="n">state</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">50</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="c1"># right</span>
        <span class="k">return</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">],</span> <span class="p">[</span><span class="n">state</span><span class="p">,</span> <span class="p">(</span><span class="n">state</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">50</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">r</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="mi">42</span> <span class="k">else</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Let’s start by considering the deterministic scenario: it is full summer and the agent is moving on very dry ground.
Within the <code class="docutils literal notranslate"><span class="pre">main</span></code> function, we first create the <code class="docutils literal notranslate"><span class="pre">madupite</span></code>-objects for the transition probability tensor and reward matrix with the functions <code class="docutils literal notranslate"><span class="pre">createTransitionProbabilityTensor</span></code> and <code class="docutils literal notranslate"><span class="pre">createStageCostMatrix</span></code>, respectively. Then we generate an instance of the <code class="docutils literal notranslate"><span class="pre">madupite</span></code> MDP-class, customize it for this setting, solve it and save the obtained policy and statistics into <cite>policy_deterministic.out</cite> and <cite>stats_deterministic.json</cite> files.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">madupite</span> <span class="k">as</span> <span class="nn">md</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="n">prealloc</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">MatrixPreallocation</span><span class="p">()</span>
    <span class="n">prealloc</span><span class="o">.</span><span class="n">d_nz</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">prealloc</span><span class="o">.</span><span class="n">o_nz</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">num_states</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">num_actions</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="n">P_mat_deterministic</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">createTransitionProbabilityTensor</span><span class="p">(</span>
        <span class="n">numStates</span><span class="o">=</span><span class="n">num_states</span><span class="p">,</span>
        <span class="n">numActions</span><span class="o">=</span><span class="n">num_actions</span><span class="p">,</span>
        <span class="n">func</span><span class="o">=</span><span class="n">P_deterministic</span><span class="p">,</span>
        <span class="n">preallocation</span><span class="o">=</span><span class="n">prealloc</span>
    <span class="p">)</span>

    <span class="n">r_mat</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">createStageCostMatrix</span><span class="p">(</span>
        <span class="n">numStates</span><span class="o">=</span><span class="n">num_states</span><span class="p">,</span>
        <span class="n">numActions</span><span class="o">=</span><span class="n">num_actions</span><span class="p">,</span>
        <span class="n">func</span><span class="o">=</span><span class="n">r</span>
    <span class="p">)</span>

    <span class="n">mdp</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">MDP</span><span class="p">()</span>
    <span class="n">mdp</span><span class="o">.</span><span class="n">setTransitionProbabilityTensor</span><span class="p">(</span><span class="n">P_mat_deterministic</span><span class="p">)</span>
    <span class="n">mdp</span><span class="o">.</span><span class="n">setStageCostMatrix</span><span class="p">(</span><span class="n">r_mat</span><span class="p">)</span>

    <span class="n">mdp</span><span class="o">.</span><span class="n">setOption</span><span class="p">(</span><span class="s2">&quot;-mode&quot;</span><span class="p">,</span> <span class="s2">&quot;MAXREWARD&quot;</span><span class="p">)</span>
    <span class="n">mdp</span><span class="o">.</span><span class="n">setOption</span><span class="p">(</span><span class="s2">&quot;-discount_factor&quot;</span><span class="p">,</span> <span class="s2">&quot;0.9&quot;</span><span class="p">)</span>

    <span class="n">mdp</span><span class="o">.</span><span class="n">setOption</span><span class="p">(</span><span class="s2">&quot;-file_policy&quot;</span><span class="p">,</span> <span class="s2">&quot;policy_deterministic.out&quot;</span><span class="p">)</span>
    <span class="n">mdp</span><span class="o">.</span><span class="n">setOption</span><span class="p">(</span><span class="s2">&quot;-file_stats&quot;</span><span class="p">,</span> <span class="s2">&quot;stats_deterministic.json&quot;</span><span class="p">)</span>

    <span class="n">mdp</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
</pre></div>
</div>
<p>In case we want to run benchmarks with a different discount factor, inner solver, transition probability tensor, stage cost etc…there is no need to create another MDP-instance, but we can simply re-use the previous one. We now consider the agent moving on ice and, because of the stochasticity, we also increase the discount factor to obtain a more robust policy. For that we add the following code to our <code class="docutils literal notranslate"><span class="pre">main</span></code> function. In particular, we have to update the transition probability tensor in our MDP instance <code class="docutils literal notranslate"><span class="pre">mdp</span></code>, and also the option <code class="docutils literal notranslate"><span class="pre">-discount_factor</span></code>. Notice that we have to update also the preallocation parameters <code class="docutils literal notranslate"><span class="pre">d_nz</span></code> and <code class="docutils literal notranslate"><span class="pre">o_nz</span></code> since this time 3 states are reachable from any state. Finally, we save the obtained policy and the statistics in the <code class="docutils literal notranslate"><span class="pre">policy_stochastic.out</span></code> and <code class="docutils literal notranslate"><span class="pre">stats_stochastic.json</span></code> files.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">prealloc</span><span class="o">.</span><span class="n">d_nz</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">prealloc</span><span class="o">.</span><span class="n">o_nz</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">P_mat_stochastic</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">createTransitionProbabilityTensor</span><span class="p">(</span>
    <span class="n">numStates</span><span class="o">=</span><span class="n">num_states</span><span class="p">,</span>
    <span class="n">numActions</span><span class="o">=</span><span class="n">num_actions</span><span class="p">,</span>
    <span class="n">func</span><span class="o">=</span><span class="n">P_stochastic</span><span class="p">,</span>
    <span class="n">preallocation</span><span class="o">=</span><span class="n">prealloc</span>
<span class="p">)</span>

<span class="n">mdp</span><span class="o">.</span><span class="n">setTransitionProbabilityTensor</span><span class="p">(</span><span class="n">P_mat_stochastic</span><span class="p">)</span>

<span class="n">mdp</span><span class="o">.</span><span class="n">setOption</span><span class="p">(</span><span class="s2">&quot;-file_policy&quot;</span><span class="p">,</span> <span class="s2">&quot;policy_stochastic.out&quot;</span><span class="p">)</span>
<span class="n">mdp</span><span class="o">.</span><span class="n">setOption</span><span class="p">(</span><span class="s2">&quot;-file_stats&quot;</span><span class="p">,</span> <span class="s2">&quot;statistics_stochastic.json&quot;</span><span class="p">)</span>

<span class="n">mdp</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
</pre></div>
</div>
<p>To try the example yourself, see <code class="docutils literal notranslate"><span class="pre">examples/tutorial/ex1.py</span></code>. Run it using <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">ex1.py</span></code> or in parallel using <code class="docutils literal notranslate"><span class="pre">mpirun</span> <span class="pre">-n</span> <span class="pre">&lt;number_of_ranks&gt;</span> <span class="pre">python</span> <span class="pre">ex1.py</span></code> where <code class="docutils literal notranslate"><span class="pre">&lt;number_of_ranks&gt;</span></code> is the number of processes.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">examples/tutorial/ex2_data_generation.py</span></code> you can see how to generate the data for this example from a NumPy or SciPy array and save it in <code class="docutils literal notranslate"><span class="pre">.bin</span></code> files. In <code class="docutils literal notranslate"><span class="pre">examples/tutorial/ex2.py</span></code> you can see how to load the data from the <code class="docutils literal notranslate"><span class="pre">.bin</span></code> files and solve the MDP.</p>
</section>
<section id="inverted-pendulum">
<h2>Inverted Pendulum<a class="headerlink" href="#inverted-pendulum" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">madupite</span></code> can also be used to create and solve MDPs from offline simulation data. In this example for instance we consider offline data collected by simulating an inverted pendulum, whose dynamic is described by the following equation:</p>
<div class="math notranslate nohighlight">
\begin{eqnarray}
   \ddot{\theta}  + \frac{g}{\ell}\sin(\theta)  &amp; = \frac{F}{m \ell^2}\,,
\end{eqnarray}</div><p>where <span class="math notranslate nohighlight">\(m\)</span> and <span class="math notranslate nohighlight">\(\ell\)</span> are the pendulum mass and length, respectively; <span class="math notranslate nohighlight">\(g\)</span> is the gravitational acceleration; <span class="math notranslate nohighlight">\(\theta\)</span> is the angular position of the pendulum, and <span class="math notranslate nohighlight">\(F\)</span> the torque that we apply on it.
The dynamic is continuous in time and space, therefore we must first discretize it in order to be able to simulate it. In particular, we select 0.01 as time-step and we discretize the space in the ranges <span class="math notranslate nohighlight">\([-10;\,10]\)</span> and <span class="math notranslate nohighlight">\([0;\, 2 \pi]\)</span> for the angular acceleration and position, respectively, and <span class="math notranslate nohighlight">\([-3;\, 3]\)</span> for the action. The finer the discretization grid that we use and the more accurate will be the resulting approximate model, but it will also result into a bigger computational and memory load. <code class="docutils literal notranslate"><span class="pre">madupite</span></code> allows one to deploy a finer discretization by distributing the memory and computation across nodes of a computing cluster.
For the simulation of the pendulum we used different discretization granularities and we collected the data into <cite>.bin</cite> files which you can download here <a class="reference download internal" download="" href="_downloads/2d97b91e4fb16a43c49304f83a976444/data.zip"><code class="xref download docutils literal notranslate"><span class="pre">data.zip</span> <span class="pre">(8.4</span> <span class="pre">MB)</span></code></a>.
The goal is to find the values of torque that minimize at each time-step the following stage-cost:</p>
<div class="math notranslate nohighlight">
\begin{eqnarray}
   g(\theta,\,\dot{\theta},\, F) = (\theta - \pi)^2 + \dot{\theta}^2 + 2 F^2\,.
\end{eqnarray}</div><p>To fit into the problem setting, we also add a discount factor of 0.999, which approximates well-enough the undiscounted setting. In the following code snippet, we use <code class="docutils literal notranslate"><span class="pre">madupite</span></code> to build and solve the MDP associated to the simulation data that we collected from the inverted pendulum when different discretization granularities are used. The optimal policy, cost and statistics are saved into files.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">madupite</span> <span class="k">as</span> <span class="nn">md</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="n">mdp</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">MDP</span><span class="p">()</span>

    <span class="c1"># the first element in the tuple is the number of states, the second element is the number of actions</span>
    <span class="n">dims_</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">121</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">441</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="p">(</span><span class="mi">1681</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span> <span class="p">(</span><span class="mi">10201</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span> <span class="p">(</span><span class="mi">22801</span><span class="p">,</span> <span class="mi">9</span><span class="p">)]</span>

    <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims_</span><span class="p">:</span>

        <span class="c1"># Load data from .bin files</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">Matrix</span><span class="o">.</span><span class="n">fromFile</span><span class="p">(</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;data/pend_g_</span><span class="si">{}</span><span class="s2">_</span><span class="si">{}</span><span class="s2">.bin&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dim</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="n">category</span><span class="o">=</span><span class="n">md</span><span class="o">.</span><span class="n">MatrixCategory</span><span class="o">.</span><span class="n">Cost</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="n">md</span><span class="o">.</span><span class="n">MatrixType</span><span class="o">.</span><span class="n">Dense</span>
        <span class="p">)</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">Matrix</span><span class="o">.</span><span class="n">fromFile</span><span class="p">(</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;data/pend_P_</span><span class="si">{}</span><span class="s2">_</span><span class="si">{}</span><span class="s2">.bin&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dim</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="n">category</span><span class="o">=</span><span class="n">md</span><span class="o">.</span><span class="n">MatrixCategory</span><span class="o">.</span><span class="n">Dynamics</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="n">md</span><span class="o">.</span><span class="n">MatrixType</span><span class="o">.</span><span class="n">Sparse</span>
        <span class="p">)</span>

        <span class="n">mdp</span><span class="o">.</span><span class="n">setStageCostMatrix</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
        <span class="n">mdp</span><span class="o">.</span><span class="n">setTransitionProbabilityTensor</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>

        <span class="c1">#mandatory options to select</span>
        <span class="n">mdp</span><span class="o">.</span><span class="n">setOption</span><span class="p">(</span><span class="s2">&quot;-mode&quot;</span><span class="p">,</span> <span class="s2">&quot;MINCOST&quot;</span><span class="p">)</span>
        <span class="n">mdp</span><span class="o">.</span><span class="n">setOption</span><span class="p">(</span><span class="s2">&quot;-discount_factor&quot;</span><span class="p">,</span> <span class="s2">&quot;0.999&quot;</span><span class="p">)</span>

        <span class="c1">#saving policy, cost and stats into files</span>
        <span class="n">mdp</span><span class="o">.</span><span class="n">setOption</span><span class="p">(</span><span class="s2">&quot;-file_policy&quot;</span><span class="p">,</span> <span class="s2">&quot;policy_</span><span class="si">{}</span><span class="s2">_</span><span class="si">{}</span><span class="s2">.out&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dim</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">mdp</span><span class="o">.</span><span class="n">setOption</span><span class="p">(</span><span class="s2">&quot;-file_cost&quot;</span><span class="p">,</span> <span class="s2">&quot;cost_</span><span class="si">{}</span><span class="s2">_</span><span class="si">{}</span><span class="s2">.out&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dim</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">mdp</span><span class="o">.</span><span class="n">setOption</span><span class="p">(</span><span class="s2">&quot;-file_stats&quot;</span><span class="p">,</span> <span class="s2">&quot;stats_</span><span class="si">{}</span><span class="s2">_</span><span class="si">{}</span><span class="s2">.json&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dim</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="n">mdp</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>In this video there is a nice graphic visualization of the results returned by <code class="docutils literal notranslate"><span class="pre">madupite</span></code> for different values of the discretization step.</p>
<video autoplay="True" controls="True" height="500" loop="True" poster="_static/pendulum.png" preload="auto" width="900"><source src="_images/pendulum.mp4" type="video/mp4"></video></section>
<section id="further-examples">
<h2>Further examples<a class="headerlink" href="#further-examples" title="Link to this heading">#</a></h2>
<p>Note that defining data from a function or loading from a file can be combined. See for example the maze example in the <code class="docutils literal notranslate"><span class="pre">examples</span></code> folder, where the transition probabilities encode a deterministic movement in a 2D grid world and the maze logic is entirely defined in the cost function which is instead loaded from a <cite>.bin</cite> file that is generated in a separate script. This can also apply to situations where, <em>e.g.</em>, the dynamics are generated from experimental data that are collected offline, while the stage-cost is defined by the user, or viceversa.
More examples on the deployment of <code class="docutils literal notranslate"><span class="pre">madupite</span></code>, such as optimal control of a double integrator, an LQR controller and the derivation of optimal health policies for the infectious disease model, are also provided in the <code class="docutils literal notranslate"><span class="pre">examples</span></code> folder.</p>
<p class="rubric">References</p>
<div role="list" class="citation-list">
<div class="citation" id="gargiani2024" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span>Gargiani2024<span class="fn-bracket">]</span></span>
<p>Gargiani, M.; Sieber. R.; Balta, E.; Liao-McPherson, D.; Lygeros, J. <em>Inexact Policy Iteration Methods for Large-Scale Markov Decision Processes</em>. <a class="reference external" href="https://arxiv.org/abs/2404.06136">https://arxiv.org/abs/2404.06136</a>.</p>
</div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="tutorial.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Tutorials</p>
      </div>
    </a>
    <a class="right-next"
       href="options.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Madupite Options</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#toy-example">Toy-Example</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inverted-pendulum">Inverted Pendulum</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#further-examples">Further examples</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="_sources/examples.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, Philip Pawlowsky, Robin Sieber.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.0.2.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.4.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>